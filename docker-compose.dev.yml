services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: isystem-app
    restart: unless-stopped
    env_file: .env
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
      APP_URL: http://localhost:8080
      ASSET_URL: http://localhost:8080
      DB_HOST: host.docker.internal
      DB_PORT: "3306"
      DB_DATABASE: dbsja
      DB_USERNAME: root
      DB_PASSWORD: ""
    ports:
      - "8080:80"
    volumes:
      - ./:/var/www/html:cached
      - storage-data:/var/www/html/storage
    command: sh -c "php artisan optimize:clear && /usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf"

  vite:
    image: node:20-alpine
    working_dir: /app
    command: sh -lc "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
    environment:
      WAYFINDER_DISABLE: "1"
    ports:
      - "5173:5173"
    volumes:
      - ./:/app:cached

volumes:
  storage-data:
